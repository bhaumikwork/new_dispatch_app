<script src="https://maps.googleapis.com/maps/api/js">
    </script>
<center>
  <div class="row">
    <div class="col-xs-12 col-md-7 box">
      <div id="map" style="width: 460 px; height: 500px"></div> 
    </div>
  </div>
</center>
<style type="text/css">
  #map {
        pointer-events:none;
      }
</style>
<script type="text/javascript">
  $(document).ready(function($) {
    initMap();
  });
  var map;
  var intl;
  // if we doesn't found current_location then doesn't call map.
  function initMap() {
    <% if current_dispatcher == @location_detail.dispatcher %>
      intl = setInterval(function(){
        if(curr_long){
          clearInterval(intl);
          $('.error').html("");
          initMapContinue();
        }
        else{
          if (!in_function)
            getLocation();
        }
      },1000);
    <% else %>
      initMapContinue();
    <% end %>
  }
  // this will load map
  function initMapContinue(){
    var directionsService = new google.maps.DirectionsService;
    var directionsDisplay = new google.maps.DirectionsRenderer;
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 16,
      zoomControl: false,
      mapTypeControl: false,
      scaleControl: false,
      streetViewControl: false,
      rotateControl: false,
      fullscreenControl: false,
      scrollwheel: false,
      navigationControl: false,
      mapTypeControl: false,
      draggable: false,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });
    directionsDisplay.setMap(null);
    directionsDisplay.setMap(map);
    directionsService.route({
      origin: '<%= @source_point %>',
      destination: '<%= @dest_point %>',
      travelMode: google.maps.TravelMode.DRIVING
    }, function(response, status) {
      if (status === google.maps.DirectionsStatus.OK) {
        directionsDisplay.setDirections(response);
      } else {
        window.alert('Directions request failed due to ' + status);
      }
    });
  } 
  
</script>