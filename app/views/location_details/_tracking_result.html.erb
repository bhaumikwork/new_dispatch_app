<center>
  <div class="row">
    <div class="col-xs-5 box">
      <h4>
        <%= @location_detail.dispatcher.full_name %><br>
        ETA is currently <%= @eta_hr %> hours <%= @eta_min + 1 %> minutes
      </h4>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-5 box">
      <div id="map" style="width: 460 px; height: 300px"></div> 
    </div>
  </div>
  <div class="row">
    <div class="col-xs-5 box">
      <h5>Next ETA will be available in :</h5>
      <h3>
        <span id="timer-hours"><%= @eta_hr %></span> hours
      	<span id="timer-minutes"><%= @eta_min %></span> minutes
      	<span id="timer-sec">55</span> seconds
      </h3>
    </div>
  </div>
</center>
<script type="text/javascript">
  // var map = new GMap2(document.getElementById("map"));
  // var directions = new GDirections(map);
  // var isCreateHeadPoint = true;
  // var headMarker, tailMarker;
  // // sets map center
  // map.setCenter(new GLatLng(23.03, +72.61), 12);
  // // sets direction polyline
  // console.log("from:<%= @source_point %> to:<%= @dest_point %>");
  // directions.load("from:<%= @source_point %> to:<%= @dest_point %>", 
  //                        { getPolyline: true, getSteps: true }); 
      var map;
      var intl;

      function initMap() {
        intl = setInterval(function(){
          if(curr_long){
            clearInterval(intl);
            initMapContinue();
          }
          else{
            if (!in_function)
              getLocation();
          }
        },1000);
      }
      function initMapContinue(){
        var directionsService = new google.maps.DirectionsService;
        var directionsDisplay = new google.maps.DirectionsRenderer;
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 16,
          zoomControl: false,
          mapTypeControl: false,
          scaleControl: false,
          streetViewControl: false,
          rotateControl: false,
          fullscreenControl: false,
          scrollwheel: false,
          navigationControl: false,
          mapTypeControl: false,
          draggable: false,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        directionsDisplay.setMap(null);
        directionsDisplay.setMap(map);
        directionsService.route({
          origin: '<%= @source_point %>',
          destination: '<%= @dest_point %>',
          travelMode: google.maps.TravelMode.DRIVING
        }, function(response, status) {
          if (status === google.maps.DirectionsStatus.OK) {
            directionsDisplay.setDirections(response);
          } else {
            window.alert('Directions request failed due to ' + status);
          }
        });
    } 
    
  var count_secs=10;
	var count_hours='<%= @eta_hr %>';
  // var count_minutes='<%= @eta_min %>'
  // var count_hours=0;
  var count_minutes=6;

  var counter=setInterval(timer, 1000); //1000 will  run it every 1 second

  function timer()
  {
    count_secs=count_secs-1;
    if (count_secs <= 0)
    {
      count_secs = 10;
      count_minutes = count_minutes-1;
      if (count_minutes >= 0)
    		$("#timer-minutes").html(count_minutes);
    }
    if (count_minutes < 0)
    {
      count_minutes = 1;
      $("#timer-minutes").html(count_minutes);
      count_hours = count_hours-1;
      if (count_hours >= 0)
        $("#timer-hours").html(count_hours);
    }
    if (count_hours < 0){
    	clearInterval(counter);
    	refreshInternal();
    	return;
    }
    $("#timer-sec").html(count_secs);
  }
  function refreshInternal(){
    $.ajax({
        url: '/refresh_tracking_result/'+'<%= @location_detail.url_token %>',
        type: 'get',
        data: {curr_lat: curr_lat,curr_long: curr_long},
        success: function (data) {
          data
        }
      });
  }
</script>